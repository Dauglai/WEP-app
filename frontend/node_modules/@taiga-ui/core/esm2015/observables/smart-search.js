import { EMPTY_ARRAY } from '@taiga-ui/cdk';
import { debounceTime, distinctUntilChanged, scan, startWith, switchMap, } from 'rxjs/operators';
export function tuiSmartSearch(getSearchFunction, searchDebounceTimeMs = 400) {
    return source => source.pipe(debounceTime(searchDebounceTimeMs), scan((previousSearched, current) => {
        return previousSearched !== `` && current.startsWith(previousSearched)
            ? previousSearched
            : current;
    }, ``), distinctUntilChanged(), switchMap(value => getSearchFunction(value).pipe(startWith(null))), startWith(EMPTY_ARRAY));
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic21hcnQtc2VhcmNoLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vcHJvamVjdHMvY29yZS9vYnNlcnZhYmxlcy9zbWFydC1zZWFyY2gudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFDLFdBQVcsRUFBQyxNQUFNLGVBQWUsQ0FBQztBQUUxQyxPQUFPLEVBQ0gsWUFBWSxFQUNaLG9CQUFvQixFQUNwQixJQUFJLEVBQ0osU0FBUyxFQUNULFNBQVMsR0FDWixNQUFNLGdCQUFnQixDQUFDO0FBRXhCLE1BQU0sVUFBVSxjQUFjLENBQzFCLGlCQUFnRixFQUNoRix1QkFBK0IsR0FBRztJQUVsQyxPQUFPLE1BQU0sQ0FBQyxFQUFFLENBQ1osTUFBTSxDQUFDLElBQUksQ0FDUCxZQUFZLENBQUMsb0JBQW9CLENBQUMsRUFDbEMsSUFBSSxDQUFDLENBQUMsZ0JBQWdCLEVBQUUsT0FBTyxFQUFFLEVBQUU7UUFDL0IsT0FBTyxnQkFBZ0IsS0FBSyxFQUFFLElBQUksT0FBTyxDQUFDLFVBQVUsQ0FBQyxnQkFBZ0IsQ0FBQztZQUNsRSxDQUFDLENBQUMsZ0JBQWdCO1lBQ2xCLENBQUMsQ0FBQyxPQUFPLENBQUM7SUFDbEIsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxFQUNOLG9CQUFvQixFQUFFLEVBQ3RCLFNBQVMsQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDLGlCQUFpQixDQUFDLEtBQUssQ0FBQyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUNsRSxTQUFTLENBQUMsV0FBVyxDQUFDLENBQ3pCLENBQUM7QUFDVixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtFTVBUWV9BUlJBWX0gZnJvbSAnQHRhaWdhLXVpL2Nkayc7XG5pbXBvcnQge09ic2VydmFibGUsIE9wZXJhdG9yRnVuY3Rpb259IGZyb20gJ3J4anMnO1xuaW1wb3J0IHtcbiAgICBkZWJvdW5jZVRpbWUsXG4gICAgZGlzdGluY3RVbnRpbENoYW5nZWQsXG4gICAgc2NhbixcbiAgICBzdGFydFdpdGgsXG4gICAgc3dpdGNoTWFwLFxufSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5cbmV4cG9ydCBmdW5jdGlvbiB0dWlTbWFydFNlYXJjaDxUPihcbiAgICBnZXRTZWFyY2hGdW5jdGlvbjogKHNlYXJjaDogc3RyaW5nKSA9PiBPYnNlcnZhYmxlPHJlYWRvbmx5IFRbXSB8IHJlYWRvbmx5IFRbXVtdPixcbiAgICBzZWFyY2hEZWJvdW5jZVRpbWVNczogbnVtYmVyID0gNDAwLFxuKTogT3BlcmF0b3JGdW5jdGlvbjxzdHJpbmcsIHJlYWRvbmx5IFRbXSB8IHJlYWRvbmx5IFRbXVtdIHwgbnVsbD4ge1xuICAgIHJldHVybiBzb3VyY2UgPT5cbiAgICAgICAgc291cmNlLnBpcGUoXG4gICAgICAgICAgICBkZWJvdW5jZVRpbWUoc2VhcmNoRGVib3VuY2VUaW1lTXMpLFxuICAgICAgICAgICAgc2NhbigocHJldmlvdXNTZWFyY2hlZCwgY3VycmVudCkgPT4ge1xuICAgICAgICAgICAgICAgIHJldHVybiBwcmV2aW91c1NlYXJjaGVkICE9PSBgYCAmJiBjdXJyZW50LnN0YXJ0c1dpdGgocHJldmlvdXNTZWFyY2hlZClcbiAgICAgICAgICAgICAgICAgICAgPyBwcmV2aW91c1NlYXJjaGVkXG4gICAgICAgICAgICAgICAgICAgIDogY3VycmVudDtcbiAgICAgICAgICAgIH0sIGBgKSxcbiAgICAgICAgICAgIGRpc3RpbmN0VW50aWxDaGFuZ2VkKCksXG4gICAgICAgICAgICBzd2l0Y2hNYXAodmFsdWUgPT4gZ2V0U2VhcmNoRnVuY3Rpb24odmFsdWUpLnBpcGUoc3RhcnRXaXRoKG51bGwpKSksXG4gICAgICAgICAgICBzdGFydFdpdGgoRU1QVFlfQVJSQVkpLFxuICAgICAgICApO1xufVxuIl19