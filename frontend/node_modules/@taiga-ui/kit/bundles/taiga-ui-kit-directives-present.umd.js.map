{"version":3,"file":"taiga-ui-kit-directives-present.umd.js","sources":["../../../projects/kit/directives/present/present.directive.ts","../../../projects/kit/directives/present/present.module.ts","../../../projects/kit/directives/present/taiga-ui-kit-directives-present.ts"],"sourcesContent":["import {\n    Directive,\n    ElementRef,\n    HostListener,\n    Inject,\n    OnDestroy,\n    Output,\n} from '@angular/core';\nimport {USER_AGENT} from '@ng-web-apis/common';\nimport {tuiIsFirefox} from '@taiga-ui/cdk';\nimport {BehaviorSubject} from 'rxjs';\nimport {distinctUntilChanged, skip} from 'rxjs/operators';\n\n@Directive({\n    selector: '[tuiPresentChange]',\n    host: {\n        '[style.animation]': '\"tuiPresent 1s infinite\"',\n    },\n})\nexport class TuiPresentDirective implements OnDestroy {\n    private readonly visibility$ = new BehaviorSubject(false);\n\n    @Output()\n    readonly tuiPresentChange = this.visibility$.pipe(distinctUntilChanged(), skip(1));\n\n    constructor(\n        @Inject(ElementRef) {nativeElement}: ElementRef<HTMLElement>,\n        @Inject(USER_AGENT) userAgent: string,\n    ) {\n        if (tuiIsFirefox(userAgent)) {\n            return;\n        }\n\n        const observer = new MutationObserver(() => {\n            if (\n                !nativeElement.offsetParent &&\n                nativeElement.offsetWidth === 0 &&\n                nativeElement.offsetHeight === 0\n            ) {\n                this.visibility$.next(false);\n            }\n        });\n\n        observer.observe(nativeElement, {\n            attributes: true,\n            attributeFilter: ['style', 'class'],\n        });\n    }\n\n    /**\n     * Someday animationcancel would work and mutation observer would not be needed:\n     * https://drafts.csswg.org/css-animations/#eventdef-animationevent-animationcancel\n     * It would also trigger on CSS like display: none on parent nodes which is awesome\n     * but currently only works in Firefox\n     * ___\n     * TODO: remove MutationObserver when we bump versions of supported browsers:\n     *** Safari 12+\n     *** Chrome 83+\n     * See: {@link https://caniuse.com/mdn-api_window_animationcancel_event}\n     */\n    @HostListener('animationcancel.self', ['false'])\n    @HostListener('animationstart.self', ['true'])\n    onAnimation(visibility: boolean): void {\n        this.visibility$.next(visibility);\n    }\n\n    ngOnDestroy(): void {\n        this.visibility$.next(false);\n    }\n}\n","import {NgModule} from '@angular/core';\n\nimport {TuiPresentDirective} from './present.directive';\n\n@NgModule({\n    declarations: [TuiPresentDirective],\n    exports: [TuiPresentDirective],\n})\nexport class TuiPresentModule {}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './index';\n"],"names":["BehaviorSubject","distinctUntilChanged","skip","tuiIsFirefox","ElementRef","USER_AGENT","i0","Directive","Inject","Output","HostListener","NgModule"],"mappings":"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"}