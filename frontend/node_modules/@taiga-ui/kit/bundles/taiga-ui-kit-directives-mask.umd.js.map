{"version":3,"file":"taiga-ui-kit-directives-mask.umd.js","sources":["../../../projects/kit/directives/mask/legacy-mask.ts","../../../projects/kit/directives/mask/taiga-ui-kit-directives-mask.ts"],"sourcesContent":["/* eslint-disable */\n/**\n * Copied from\n * {@link https://github.com/text-mask/text-mask/blob/master/angular2/src/angular2TextMask.ts angular2-text-mask}\n * ___\n * \"angular2-text-mask\" is a legacy not-maintained library. It is published using legacy View Engine distribution.\n * Stackblitz fails to run \"View Engine\"-libraries in Ivy application.\n * See {@link https://github.com/Tinkoff/taiga-ui/issues/2541#issuecomment-1235516443 this comment}.\n */\nimport {\n    Directive,\n    ElementRef,\n    forwardRef,\n    Inject,\n    Input,\n    NgModule,\n    OnChanges,\n    Optional,\n    Renderer2,\n} from '@angular/core';\nimport {\n    COMPOSITION_BUFFER_MODE,\n    ControlValueAccessor,\n    NG_VALUE_ACCESSOR,\n} from '@angular/forms';\nimport {ÉµgetDOM as getDOM} from '@angular/platform-browser';\nimport {TUI_LEGACY_MASK, TuiTextMaskOptions} from '@taiga-ui/core';\nimport {createTextMaskInputElement} from 'text-mask-core';\n\n/**\n * We must check whether the agent is Android because composition events\n * behave differently between iOS and Android.\n */\nfunction _isAndroid(): boolean {\n    const userAgent = getDOM() ? getDOM().getUserAgent() : '';\n    return /android (\\d+)/.test(userAgent.toLowerCase());\n}\n\n/**\n * @internal\n * @deprecated\n * Don't use it! It can be deleted at any time (even in minor releases).\n * Use {@link https://github.com/text-mask/text-mask/tree/master/angular2 angular2-text-mask} instead.\n */\n@Directive({\n    host: {\n        '(input)': '_handleInput($event.target.value)',\n        '(blur)': 'onTouched()',\n        '(compositionstart)': '_compositionStart()',\n        '(compositionend)': '_compositionEnd($event.target.value)',\n    },\n    selector: '[textMask]',\n    exportAs: 'textMask',\n    providers: [\n        {\n            provide: NG_VALUE_ACCESSOR,\n            useExisting: forwardRef(() => MaskedInputDirective),\n            multi: true,\n        },\n        {\n            provide: TUI_LEGACY_MASK,\n            useExisting: forwardRef(() => MaskedInputDirective),\n        },\n    ],\n})\nexport class MaskedInputDirective implements ControlValueAccessor, OnChanges {\n    @Input('textMask') textMaskConfig: TuiTextMaskOptions = {\n        mask: [],\n        guide: true,\n        placeholderChar: '_',\n        pipe: undefined,\n        keepCharPositions: false,\n    };\n\n    onChange = (_: any) => {};\n    onTouched = () => {};\n\n    private textMaskInputElement: any;\n    private inputElement!: HTMLInputElement;\n\n    /** Whether the user is creating a composition string (IME events). */\n    private _composing = false;\n\n    constructor(\n        private _renderer: Renderer2,\n        private _elementRef: ElementRef,\n        @Optional() @Inject(COMPOSITION_BUFFER_MODE) private _compositionMode: boolean,\n    ) {\n        if (this._compositionMode == null) {\n            this._compositionMode = !_isAndroid();\n        }\n    }\n\n    ngOnChanges() {\n        this._setupMask(true);\n        if (this.textMaskInputElement !== undefined) {\n            this.textMaskInputElement.update(this.inputElement.value);\n        }\n    }\n\n    writeValue(value: any) {\n        this._setupMask();\n\n        // set the initial value for cases where the mask is disabled\n        const normalizedValue = value == null ? '' : value;\n        this._renderer.setProperty(this.inputElement, 'value', normalizedValue);\n\n        if (this.textMaskInputElement !== undefined) {\n            this.textMaskInputElement.update(value);\n        }\n    }\n\n    registerOnChange(fn: (_: any) => void): void {\n        this.onChange = fn;\n    }\n    registerOnTouched(fn: () => void): void {\n        this.onTouched = fn;\n    }\n\n    setDisabledState(isDisabled: boolean): void {\n        this._renderer.setProperty(\n            this._elementRef.nativeElement,\n            'disabled',\n            isDisabled,\n        );\n    }\n\n    _handleInput(value: any) {\n        if (!this._compositionMode || (this._compositionMode && !this._composing)) {\n            this._setupMask();\n\n            if (this.textMaskInputElement !== undefined) {\n                this.textMaskInputElement.update(value);\n\n                // get the updated value\n                value = this.inputElement.value;\n                this.onChange(value);\n            }\n        }\n    }\n\n    _setupMask(create = false) {\n        if (!this.inputElement) {\n            if (this._elementRef.nativeElement.tagName.toUpperCase() === 'INPUT') {\n                // `textMask` directive is used directly on an input element\n                this.inputElement = this._elementRef.nativeElement;\n            } else {\n                // `textMask` directive is used on an abstracted input element, `md-input-container`, etc\n                this.inputElement =\n                    this._elementRef.nativeElement.getElementsByTagName('INPUT')[0];\n            }\n        }\n\n        if (this.inputElement && create) {\n            this.textMaskInputElement = createTextMaskInputElement(\n                Object.assign({inputElement: this.inputElement}, this.textMaskConfig),\n            );\n        }\n    }\n\n    _compositionStart(): void {\n        this._composing = true;\n    }\n\n    _compositionEnd(value: any): void {\n        this._composing = false;\n        this._compositionMode && this._handleInput(value);\n    }\n}\n\n/**\n * @internal\n * @deprecated\n * Don't use it! It can be deleted at any time (even in minor releases).\n * Use {@link https://github.com/text-mask/text-mask/tree/master/angular2 angular2-text-mask} instead.\n */\n@NgModule({\n    declarations: [MaskedInputDirective],\n    exports: [MaskedInputDirective],\n})\nexport class TextMaskModule {}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './index';\n"],"names":["getDOM","createTextMaskInputElement","i0","COMPOSITION_BUFFER_MODE","NG_VALUE_ACCESSOR","forwardRef","TUI_LEGACY_MASK","Directive","Optional","Inject","Input","NgModule"],"mappings":"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"}