{"version":3,"file":"taiga-ui-kit-directives-present.js","sources":["../../../projects/kit/directives/present/present.directive.ts","../../../projects/kit/directives/present/present.module.ts","../../../projects/kit/directives/present/taiga-ui-kit-directives-present.ts"],"sourcesContent":["import {\n    Directive,\n    ElementRef,\n    HostListener,\n    Inject,\n    OnDestroy,\n    Output,\n} from '@angular/core';\nimport {USER_AGENT} from '@ng-web-apis/common';\nimport {tuiIsFirefox} from '@taiga-ui/cdk';\nimport {BehaviorSubject} from 'rxjs';\nimport {distinctUntilChanged, skip} from 'rxjs/operators';\n\n@Directive({\n    selector: '[tuiPresentChange]',\n    host: {\n        '[style.animation]': '\"tuiPresent 1s infinite\"',\n    },\n})\nexport class TuiPresentDirective implements OnDestroy {\n    private readonly visibility$ = new BehaviorSubject(false);\n\n    @Output()\n    readonly tuiPresentChange = this.visibility$.pipe(distinctUntilChanged(), skip(1));\n\n    constructor(\n        @Inject(ElementRef) {nativeElement}: ElementRef<HTMLElement>,\n        @Inject(USER_AGENT) userAgent: string,\n    ) {\n        if (tuiIsFirefox(userAgent)) {\n            return;\n        }\n\n        const observer = new MutationObserver(() => {\n            if (\n                !nativeElement.offsetParent &&\n                nativeElement.offsetWidth === 0 &&\n                nativeElement.offsetHeight === 0\n            ) {\n                this.visibility$.next(false);\n            }\n        });\n\n        observer.observe(nativeElement, {\n            attributes: true,\n            attributeFilter: ['style', 'class'],\n        });\n    }\n\n    /**\n     * Someday animationcancel would work and mutation observer would not be needed:\n     * https://drafts.csswg.org/css-animations/#eventdef-animationevent-animationcancel\n     * It would also trigger on CSS like display: none on parent nodes which is awesome\n     * but currently only works in Firefox\n     * ___\n     * TODO: remove MutationObserver when we bump versions of supported browsers:\n     *** Safari 12+\n     *** Chrome 83+\n     * See: {@link https://caniuse.com/mdn-api_window_animationcancel_event}\n     */\n    @HostListener('animationcancel.self', ['false'])\n    @HostListener('animationstart.self', ['true'])\n    onAnimation(visibility: boolean): void {\n        this.visibility$.next(visibility);\n    }\n\n    ngOnDestroy(): void {\n        this.visibility$.next(false);\n    }\n}\n","import {NgModule} from '@angular/core';\n\nimport {TuiPresentDirective} from './present.directive';\n\n@NgModule({\n    declarations: [TuiPresentDirective],\n    exports: [TuiPresentDirective],\n})\nexport class TuiPresentModule {}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './index';\n"],"names":[],"mappings":"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"}