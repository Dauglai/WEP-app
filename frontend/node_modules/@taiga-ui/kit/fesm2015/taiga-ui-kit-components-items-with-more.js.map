{"version":3,"file":"taiga-ui-kit-components-items-with-more.js","sources":["../../../projects/kit/components/items-with-more/items-with-more.directive.ts","../../../projects/kit/components/items-with-more/items-with-more.service.ts","../../../projects/kit/components/items-with-more/more.directive.ts","../../../projects/kit/components/items-with-more/items-with-more.component.ts","../../../projects/kit/components/items-with-more/items-with-more.template.html","../../../projects/kit/components/items-with-more/items-with-more.module.ts","../../../projects/kit/components/items-with-more/taiga-ui-kit-components-items-with-more.ts"],"sourcesContent":["import {Directive, Input} from '@angular/core';\nimport {AbstractTuiController, tuiDefaultProp} from '@taiga-ui/cdk';\n\n@Directive({\n    selector: 'tui-items-with-more',\n})\nexport class TuiItemsWithMoreDirective extends AbstractTuiController {\n    @Input()\n    @tuiDefaultProp()\n    itemsLimit = Infinity;\n\n    @Input()\n    @tuiDefaultProp()\n    required = -1;\n}\n","import {ElementRef, Inject, Injectable, NgZone} from '@angular/core';\nimport {MutationObserverService} from '@ng-web-apis/mutation-observer';\nimport {tuiClamp, TuiResizeService, tuiZoneOptimized} from '@taiga-ui/cdk';\nimport {merge, Observable} from 'rxjs';\nimport {distinctUntilChanged, map, share, throttleTime} from 'rxjs/operators';\n\nimport {TuiItemsWithMoreDirective} from './items-with-more.directive';\n\n@Injectable()\nexport class TuiItemsWithMoreService extends Observable<number> {\n    readonly stream$ = merge(this.directive.change$, this.mutation$, this.resize$).pipe(\n        throttleTime(0),\n        map(() => this.getOverflowIndex()),\n        distinctUntilChanged(),\n        tuiZoneOptimized(this.ngZone),\n        share(),\n    );\n\n    constructor(\n        @Inject(NgZone) private readonly ngZone: NgZone,\n        @Inject(ElementRef) private readonly el: ElementRef<HTMLElement>,\n        @Inject(MutationObserverService) private readonly mutation$: Observable<unknown>,\n        @Inject(TuiResizeService) private readonly resize$: Observable<unknown>,\n        @Inject(TuiItemsWithMoreDirective)\n        private readonly directive: TuiItemsWithMoreDirective,\n    ) {\n        super(subscriber => this.stream$.subscribe(subscriber));\n    }\n\n    private getOverflowIndex(): number {\n        const {clientWidth, children} = this.el.nativeElement;\n        const items = Array.from(children, ({clientWidth}) => clientWidth);\n        const first = this.directive.required === -1 ? 0 : this.directive.required;\n        const last = items.length - 1;\n        const more = children[last]?.tagName === `SPAN` ? items[last] : 0;\n\n        items.unshift(...items.splice(first, 1));\n\n        let total = items.reduce((sum, width) => sum + width, 0) - more;\n\n        if (total <= clientWidth && this.directive.itemsLimit >= items.length) {\n            return this.maxItems;\n        }\n\n        for (let i = last - 1; i > 0; i--) {\n            total -= items[i];\n\n            if (total + more <= clientWidth) {\n                return tuiClamp(\n                    i > this.directive.required ? i - 1 : i - 2,\n                    -1,\n                    this.maxItems,\n                );\n            }\n        }\n\n        return -1;\n    }\n\n    private get maxItems(): number {\n        return this.directive.itemsLimit > this.directive.required\n            ? this.directive.itemsLimit - 1\n            : this.directive.itemsLimit - 2;\n    }\n}\n","import {Directive} from '@angular/core';\nimport {TuiContextWithImplicit} from '@taiga-ui/cdk';\n\n@Directive({\n    selector: '[tuiMore]',\n})\nexport class TuiMoreDirective {\n    static ngTemplateContextGuard(\n        _dir: TuiMoreDirective,\n        _ctx: unknown,\n    ): _ctx is TuiContextWithImplicit<number> {\n        return true;\n    }\n}\n","import {\n    ChangeDetectionStrategy,\n    Component,\n    ContentChild,\n    ContentChildren,\n    Inject,\n    QueryList,\n    TemplateRef,\n} from '@angular/core';\nimport {\n    MUTATION_OBSERVER_INIT,\n    MutationObserverService,\n} from '@ng-web-apis/mutation-observer';\nimport {\n    EMPTY_QUERY,\n    TuiContextWithImplicit,\n    TuiDestroyService,\n    TuiItemDirective,\n    TuiResizeService,\n} from '@taiga-ui/cdk';\nimport {Observable} from 'rxjs';\n\nimport {TuiItemsWithMoreDirective} from './items-with-more.directive';\nimport {TuiItemsWithMoreService} from './items-with-more.service';\nimport {TuiMoreDirective} from './more.directive';\n\n@Component({\n    selector: 'tui-items-with-more',\n    templateUrl: './items-with-more.template.html',\n    styleUrls: ['./items-with-more.style.less'],\n    providers: [\n        MutationObserverService,\n        TuiResizeService,\n        TuiDestroyService,\n        TuiItemsWithMoreService,\n        {\n            provide: MUTATION_OBSERVER_INIT,\n            useValue: {\n                childList: true,\n                characterData: true,\n                subtree: true,\n            },\n        },\n    ],\n    changeDetection: ChangeDetectionStrategy.OnPush,\n})\nexport class TuiItemsWithMoreComponent {\n    @ContentChildren(TuiItemDirective, {read: TemplateRef, descendants: true})\n    readonly items: QueryList<TemplateRef<unknown>> = EMPTY_QUERY;\n\n    @ContentChild(TuiMoreDirective, {read: TemplateRef})\n    readonly more?: TemplateRef<TuiContextWithImplicit<number>>;\n\n    constructor(\n        @Inject(TuiItemsWithMoreDirective) readonly directive: TuiItemsWithMoreDirective,\n        @Inject(TuiItemsWithMoreService) readonly lastVisibleIndex$: Observable<number>,\n    ) {}\n}\n","<ng-container *ngIf=\"items.changes | async\"></ng-container>\n<ng-container *tuiLet=\"(lastVisibleIndex$ | async) || 0 as lastIndex\">\n    <div\n        *ngFor=\"let item of items; let index = index\"\n        class=\"t-item\"\n        [class.t-item_hidden]=\"index > lastIndex && index !== directive.required\"\n        [tuiProjectClass]=\"['_active']\"\n    >\n        <ng-container *ngTemplateOutlet=\"item\"></ng-container>\n    </div>\n    <span\n        *ngIf=\"more && lastIndex < items.length - 1\"\n        class=\"t-item\"\n        [class.t-item_hidden]=\"lastIndex >= items.length - 1\"\n        [tuiProjectClass]=\"['_active']\"\n    >\n        <ng-container\n            [ngTemplateOutlet]=\"more\"\n            [ngTemplateOutletContext]=\"{$implicit: lastIndex}\"\n        ></ng-container>\n    </span>\n</ng-container>\n","import {CommonModule} from '@angular/common';\nimport {NgModule} from '@angular/core';\nimport {TuiItemDirective, TuiItemModule, TuiLetModule} from '@taiga-ui/cdk';\nimport {TuiProjectClassModule} from '@taiga-ui/kit/directives';\n\nimport {TuiItemsWithMoreComponent} from './items-with-more.component';\nimport {TuiItemsWithMoreDirective} from './items-with-more.directive';\nimport {TuiMoreDirective} from './more.directive';\n\n@NgModule({\n    imports: [CommonModule, TuiItemModule, TuiLetModule, TuiProjectClassModule],\n    declarations: [\n        TuiItemsWithMoreComponent,\n        TuiItemsWithMoreDirective,\n        TuiMoreDirective,\n    ],\n    exports: [\n        TuiItemsWithMoreComponent,\n        TuiItemsWithMoreDirective,\n        TuiMoreDirective,\n        TuiItemDirective,\n    ],\n})\nexport class TuiItemsWithMoreModule {}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './index';\n"],"names":["i1"],"mappings":"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"}