{"version":3,"file":"taiga-ui-cdk-directives-focus-trap.umd.js","sources":["../../../projects/cdk/directives/focus-trap/focus-trap.directive.ts","../../../projects/cdk/directives/focus-trap/focus-trap.module.ts","../../../projects/cdk/directives/focus-trap/taiga-ui-cdk-directives-focus-trap.ts"],"sourcesContent":["import {DOCUMENT} from '@angular/common';\nimport {\n    Directive,\n    ElementRef,\n    HostListener,\n    Inject,\n    OnDestroy,\n    Renderer2,\n} from '@angular/core';\nimport {tuiContainsOrAfter, tuiIsHTMLElement} from '@taiga-ui/cdk/utils/dom';\nimport {\n    tuiBlurNativeFocused,\n    tuiGetClosestFocusable,\n    tuiGetNativeFocused,\n} from '@taiga-ui/cdk/utils/focus';\n\n@Directive({\n    selector: '[tuiFocusTrap]',\n    host: {\n        tabIndex: '0',\n    },\n})\nexport class TuiFocusTrapDirective implements OnDestroy {\n    private readonly activeElement = tuiGetNativeFocused(this.doc);\n\n    constructor(\n        @Inject(DOCUMENT) private readonly doc: Document,\n        @Inject(ElementRef)\n        private readonly el: ElementRef<HTMLElement>,\n        @Inject(Renderer2) private readonly renderer: Renderer2,\n    ) {\n        /**\n         * This would cause currently focused element to lose focus,\n         * but it might cause ExpressionChanged error due to potential HostBinding.\n         * Microtask keeps it in the same frame but allows change detection to run\n         */\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\n        Promise.resolve().then(() => {\n            this.el.nativeElement.focus();\n        });\n    }\n\n    @HostListener('blur')\n    onBlur(): void {\n        this.renderer.removeAttribute(this.el.nativeElement, 'tabIndex');\n    }\n\n    @HostListener('window:focusin.silent', ['$event.target'])\n    onFocusIn(node: Node): void {\n        const {nativeElement} = this.el;\n\n        if (tuiContainsOrAfter(nativeElement, node)) {\n            return;\n        }\n\n        const focusable = tuiGetClosestFocusable({\n            initial: nativeElement,\n            root: nativeElement,\n        });\n\n        if (focusable) {\n            focusable.focus();\n        }\n    }\n\n    ngOnDestroy(): void {\n        tuiBlurNativeFocused(this.doc);\n\n        /**\n         * HostListeners are triggered even after ngOnDestroy\n         * {@link https://github.com/angular/angular/issues/38100}\n         * so we need to delay it but stay in the same sync cycle,\n         * therefore using Promise instead of setTimeout\n         */\n        // eslint-disable-next-line\n        Promise.resolve().then(() => {\n            if (tuiIsHTMLElement(this.activeElement)) {\n                this.activeElement.focus();\n            }\n        });\n    }\n}\n","import {NgModule} from '@angular/core';\n\nimport {TuiFocusTrapDirective} from './focus-trap.directive';\n\n@NgModule({\n    declarations: [TuiFocusTrapDirective],\n    exports: [TuiFocusTrapDirective],\n})\nexport class TuiFocusTrapModule {}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './index';\n"],"names":["tuiGetNativeFocused","tuiContainsOrAfter","tuiGetClosestFocusable","tuiBlurNativeFocused","tuiIsHTMLElement","i0","DOCUMENT","ElementRef","Renderer2","Directive","Inject","HostListener","NgModule"],"mappings":"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"}