{"version":3,"file":"taiga-ui-cdk-directives-overscroll.js","sources":["../../../projects/cdk/directives/overscroll/overscroll.directive.ts","../../../projects/cdk/directives/overscroll/overscroll.module.ts","../../../projects/cdk/directives/overscroll/taiga-ui-cdk-directives-overscroll.ts"],"sourcesContent":["import {\n    Directive,\n    ElementRef,\n    HostBinding,\n    Inject,\n    Input,\n    NgZone,\n    Self,\n} from '@angular/core';\nimport {tuiTypedFromEvent, tuiZonefree} from '@taiga-ui/cdk/observables';\nimport {TuiDestroyService} from '@taiga-ui/cdk/services';\nimport {TuiEventWith, TuiOverscrollMode} from '@taiga-ui/cdk/types';\nimport {tuiCanScroll, tuiGetScrollParent, tuiIsElement} from '@taiga-ui/cdk/utils/dom';\nimport {Observable} from 'rxjs';\nimport {filter, switchMap, takeUntil, tap} from 'rxjs/operators';\n\n/**\n * Directive to isolate scrolling, i.e. prevent body scroll behind modal dialog\n */\n@Directive({\n    selector: '[tuiOverscroll]',\n    providers: [TuiDestroyService],\n})\nexport class TuiOverscrollDirective {\n    @Input('tuiOverscroll')\n    mode: TuiOverscrollMode | '' = 'scroll';\n\n    constructor(\n        @Inject(ElementRef) {nativeElement}: ElementRef<HTMLElement>,\n        @Inject(NgZone) ngZone: NgZone,\n        @Self() @Inject(TuiDestroyService) destroy$: Observable<void>,\n    ) {\n        tuiTypedFromEvent(nativeElement, 'wheel', {passive: false})\n            .pipe(\n                filter(() => this.enabled),\n                tuiZonefree(ngZone),\n                takeUntil(destroy$),\n            )\n            .subscribe(event => {\n                this.processEvent(\n                    event,\n                    !!event.deltaY,\n                    event.deltaY ? event.deltaY < 0 : event.deltaX < 0,\n                );\n            });\n\n        tuiTypedFromEvent(nativeElement, 'touchstart', {passive: true})\n            .pipe(\n                switchMap(({touches}) => {\n                    let {clientX, clientY} = touches[0];\n                    let deltaX = 0;\n                    let deltaY = 0;\n                    let vertical: boolean;\n\n                    return tuiTypedFromEvent(nativeElement, 'touchmove', {\n                        passive: false,\n                    }).pipe(\n                        filter(() => this.enabled),\n                        tap(event => {\n                            // We have to have it in tap instead of subscribe due to variables in closure\n                            const changedTouch = event.changedTouches[0];\n\n                            deltaX = clientX - changedTouch.clientX;\n                            deltaY = clientY - changedTouch.clientY;\n                            clientX = changedTouch.clientX;\n                            clientY = changedTouch.clientY;\n\n                            if (vertical === undefined) {\n                                vertical = Math.abs(deltaY) > Math.abs(deltaX);\n                            }\n\n                            this.processEvent(\n                                event,\n                                vertical,\n                                vertical ? deltaY < 0 : deltaX < 0,\n                            );\n                        }),\n                    );\n                }),\n                tuiZonefree(ngZone),\n                takeUntil(destroy$),\n            )\n            .subscribe();\n    }\n\n    get enabled(): boolean {\n        return this.mode !== 'none';\n    }\n\n    @HostBinding('style.overscrollBehavior')\n    get overscrollBehavior(): 'contain' | null {\n        return this.enabled ? 'contain' : null;\n    }\n\n    private processEvent(\n        event: TuiEventWith<Event, HTMLElement>,\n        vertical: boolean,\n        negative: boolean,\n    ): void {\n        const {target, currentTarget, cancelable} = event;\n\n        if (\n            !cancelable ||\n            !tuiIsElement(target) ||\n            (target as HTMLInputElement)?.type === 'range'\n        ) {\n            return;\n        }\n\n        // This is all what's needed in Chrome/Firefox thanks to CSS overscroll-behavior\n        if (\n            this.mode === 'all' &&\n            ((vertical && !currentTarget.contains(tuiGetScrollParent(target))) ||\n                (!vertical && !currentTarget.contains(tuiGetScrollParent(target, false))))\n        ) {\n            event.preventDefault();\n\n            return;\n        }\n\n        // This is Safari/IE/Edge fallback\n        if (\n            vertical &&\n            ((negative && !tuiCanScroll(target, currentTarget, true, false)) ||\n                (!negative && !tuiCanScroll(target, currentTarget, true, true)))\n        ) {\n            event.preventDefault();\n\n            return;\n        }\n\n        if (\n            !vertical &&\n            ((negative && !tuiCanScroll(target, currentTarget, false, false)) ||\n                (!negative && !tuiCanScroll(target, currentTarget, false, true)))\n        ) {\n            event.preventDefault();\n        }\n    }\n}\n","import {NgModule} from '@angular/core';\n\nimport {TuiOverscrollDirective} from './overscroll.directive';\n\n@NgModule({\n    declarations: [TuiOverscrollDirective],\n    exports: [TuiOverscrollDirective],\n})\nexport class TuiOverscrollModule {}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './index';\n"],"names":[],"mappings":"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"}