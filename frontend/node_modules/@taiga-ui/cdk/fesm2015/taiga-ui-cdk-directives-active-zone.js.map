{"version":3,"file":"taiga-ui-cdk-directives-active-zone.js","sources":["../../../projects/cdk/directives/active-zone/active-zone.directive.ts","../../../projects/cdk/directives/active-zone/active-zone.module.ts","../../../projects/cdk/directives/active-zone/taiga-ui-cdk-directives-active-zone.ts"],"sourcesContent":["import {\n    Directive,\n    ElementRef,\n    Inject,\n    Input,\n    NgZone,\n    OnDestroy,\n    Optional,\n    Output,\n    SkipSelf,\n} from '@angular/core';\nimport {tuiDefaultProp, tuiPure} from '@taiga-ui/cdk/decorators';\nimport {tuiZoneOptimized} from '@taiga-ui/cdk/observables';\nimport {TUI_ACTIVE_ELEMENT} from '@taiga-ui/cdk/tokens';\nimport {tuiArrayRemove} from '@taiga-ui/cdk/utils';\nimport {Observable} from 'rxjs';\nimport {distinctUntilChanged, map, skip, startWith} from 'rxjs/operators';\n\n@Directive({\n    selector:\n        '[tuiActiveZone]:not(ng-container), [tuiActiveZoneChange]:not(ng-container), [tuiActiveZoneParent]:not(ng-container)',\n    exportAs: 'tuiActiveZone',\n})\nexport class TuiActiveZoneDirective implements OnDestroy {\n    private subActiveZones: readonly TuiActiveZoneDirective[] = [];\n\n    private tuiActiveZoneParent: TuiActiveZoneDirective | null = null;\n\n    @Input('tuiActiveZoneParent')\n    @tuiDefaultProp()\n    set tuiActiveZoneParentSetter(zone: TuiActiveZoneDirective | null) {\n        this.setZone(zone);\n    }\n\n    @Output()\n    readonly tuiActiveZoneChange = this.active$.pipe(\n        map(element => !!element && this.contains(element)),\n        startWith(false),\n        distinctUntilChanged(),\n        skip(1),\n        tuiZoneOptimized(this.ngZone),\n    );\n\n    constructor(\n        @Inject(TUI_ACTIVE_ELEMENT)\n        private readonly active$: Observable<Element | null>,\n        @Inject(NgZone) private readonly ngZone: NgZone,\n        @Inject(ElementRef) private readonly el: ElementRef<Element>,\n        @Optional()\n        @SkipSelf()\n        @Inject(TuiActiveZoneDirective)\n        private readonly directParentActiveZone: TuiActiveZoneDirective | null,\n    ) {\n        if (this.directParentActiveZone) {\n            this.directParentActiveZone.addSubActiveZone(this);\n        }\n    }\n\n    ngOnDestroy(): void {\n        if (this.directParentActiveZone) {\n            this.directParentActiveZone.removeSubActiveZone(this);\n        }\n\n        if (this.tuiActiveZoneParent) {\n            this.tuiActiveZoneParent.removeSubActiveZone(this);\n        }\n    }\n\n    contains(node: Node): boolean {\n        return (\n            this.el.nativeElement.contains(node) ||\n            this.subActiveZones.some(\n                (item, index, array) =>\n                    array.indexOf(item) === index && item.contains(node),\n            )\n        );\n    }\n\n    @tuiPure\n    private setZone(zone: TuiActiveZoneDirective | null): void {\n        if (this.tuiActiveZoneParent) {\n            this.tuiActiveZoneParent.removeSubActiveZone(this);\n        }\n\n        if (zone) {\n            zone.addSubActiveZone(this);\n        }\n\n        this.tuiActiveZoneParent = zone;\n    }\n\n    private addSubActiveZone(activeZone: TuiActiveZoneDirective): void {\n        this.subActiveZones = [...this.subActiveZones, activeZone];\n    }\n\n    private removeSubActiveZone(activeZone: TuiActiveZoneDirective): void {\n        this.subActiveZones = tuiArrayRemove(\n            this.subActiveZones,\n            this.subActiveZones.indexOf(activeZone),\n        );\n    }\n}\n","import {NgModule} from '@angular/core';\n\nimport {TuiActiveZoneDirective} from './active-zone.directive';\n\n@NgModule({\n    declarations: [TuiActiveZoneDirective],\n    exports: [TuiActiveZoneDirective],\n})\nexport class TuiActiveZoneModule {}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './index';\n"],"names":[],"mappings":"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"}