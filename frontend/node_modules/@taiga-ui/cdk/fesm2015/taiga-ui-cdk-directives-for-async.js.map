{"version":3,"file":"taiga-ui-cdk-directives-for-async.js","sources":["../../../projects/cdk/directives/for-async/for-async.directive.ts","../../../projects/cdk/directives/for-async/for-async.module.ts","../../../projects/cdk/directives/for-async/taiga-ui-cdk-directives-for-async.ts"],"sourcesContent":["import {\n    Directive,\n    Inject,\n    Input,\n    OnChanges,\n    OnDestroy,\n    TemplateRef,\n    ViewContainerRef,\n} from '@angular/core';\nimport {from, of, Subject} from 'rxjs';\nimport {concatMap, delay, takeUntil} from 'rxjs/operators';\n\n@Directive({selector: '[tuiForAsync][tuiForAsyncOf]'})\nexport class TuiForAsyncDirective<T extends readonly any[]>\n    implements OnChanges, OnDestroy\n{\n    private readonly destroy$ = new Subject<void>();\n\n    @Input()\n    tuiForAsyncOf: T | null | undefined;\n\n    @Input()\n    tuiForAsyncTimeout = 10;\n\n    constructor(\n        @Inject(ViewContainerRef) private readonly view: ViewContainerRef,\n        @Inject(TemplateRef) private readonly template: TemplateRef<unknown>,\n    ) {}\n\n    ngOnChanges(): void {\n        this.clearViewForOldNodes();\n        this.createAsyncViewForNewNodes();\n    }\n\n    ngOnDestroy(): void {\n        this.clearViewForOldNodes();\n        this.destroy$.complete();\n    }\n\n    private createAsyncViewForNewNodes(): void {\n        from(this.iterableValues)\n            .pipe(\n                concatMap(entry =>\n                    this.tuiForAsyncTimeout > 0\n                        ? of(entry).pipe(delay(this.tuiForAsyncTimeout))\n                        : of(entry),\n                ),\n                takeUntil(this.destroy$),\n            )\n            .subscribe(([index, item]) => this.createEmbeddedView(item, index));\n    }\n\n    private get iterableValues(): IterableIterator<[number, T]> {\n        return (this.tuiForAsyncOf ?? []).entries();\n    }\n\n    private createEmbeddedView<T>(item: T, index: number): void {\n        this.view\n            .createEmbeddedView(this.template, {$implicit: item, index}, index)\n            .detectChanges();\n    }\n\n    private clearViewForOldNodes(): void {\n        this.destroy$.next();\n        this.view.clear();\n    }\n}\n","import {NgModule} from '@angular/core';\n\nimport {TuiForAsyncDirective} from './for-async.directive';\n\n/**\n * @experimental\n */\n@NgModule({\n    declarations: [TuiForAsyncDirective],\n    exports: [TuiForAsyncDirective],\n})\nexport class TuiForAsyncModule {}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './index';\n"],"names":[],"mappings":"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"}